<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Plot Twisted</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,500&family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=Special+Elite&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
/* ============================================
   PLOT TWISTED - RETRO CINEMA AESTHETIC
   ============================================ */

:root {
    --bg-deep: #0a0a0f;
    --bg-dark: #12121a;
    --bg-card: #1a1a24;
    --bg-elevated: #242430;
    
    --gold-primary: #d4a853;
    --gold-light: #f0d078;
    --gold-dark: #a67c32;
    --gold-glow: rgba(212, 168, 83, 0.4);
    
    --red-primary: #c41e3a;
    --red-light: #e63950;
    --red-glow: rgba(196, 30, 58, 0.5);
    
    --green-correct: #4a9d5b;
    --green-glow: rgba(74, 157, 91, 0.5);
    
    --cream: #f5f0e6;
    --cream-muted: #c9c4b8;
    --text-muted: #6b6b7b;
    
    --font-display: 'Playfair Display', serif;
    --font-title: 'Bebas Neue', sans-serif;
    --font-body: 'Inter', sans-serif;
    --font-typewriter: 'Special Elite', monospace;
    
    --shadow-glow: 0 0 30px var(--gold-glow);
    --shadow-deep: 0 10px 40px rgba(0,0,0,0.5);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
    height: 100%;
    font-family: var(--font-body);
    background: var(--bg-deep);
    color: var(--cream);
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
}

/* Film Grain */
.film-grain {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9999;
    opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
}

/* Screens */
.screen {
    display: none;
    position: fixed;
    inset: 0;
    flex-direction: column;
    opacity: 0;
    transition: opacity 0.4s ease;
}

.screen.active {
    display: flex;
    opacity: 1;
}

/* ============================================
   START SCREEN
   ============================================ */

#startScreen {
    background: var(--bg-deep);
    justify-content: center;
    align-items: center;
    padding: 20px;
    position: relative;
    overflow: hidden;
}

/* Spotlight Effect */
.spotlight {
    position: absolute;
    top: -20%;
    left: 50%;
    transform: translateX(-50%);
    width: 140%;
    height: 70%;
    background: radial-gradient(ellipse at 50% 0%, rgba(212, 168, 83, 0.15) 0%, rgba(212, 168, 83, 0.05) 30%, transparent 60%);
    pointer-events: none;
}

.spotlight-secondary {
    position: absolute;
    bottom: -30%;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    height: 50%;
    background: radial-gradient(ellipse at 50% 100%, rgba(196, 30, 58, 0.08) 0%, transparent 50%);
    pointer-events: none;
}

/* Title Spotlight - soft glow behind PLOT */
.title-spotlight {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -40%);
    width: 280px;
    height: 160px;
    background: radial-gradient(ellipse at 50% 50%, rgba(212, 168, 83, 0.3) 0%, rgba(212, 168, 83, 0.1) 40%, transparent 70%);
    pointer-events: none;
    filter: blur(25px);
    z-index: -1;
}

.home-content {
    position: relative;
    z-index: 1;
    max-width: 400px;
    width: 100%;
    padding: 20px;
}

.main-title {
    text-align: center;
    margin-bottom: 15px;
    position: relative;
}

.title-plot {
    font-family: var(--font-display);
    font-size: clamp(3.5rem, 12vw, 5rem);
    font-weight: 900;
    color: var(--cream);
    letter-spacing: 0.02em;
    line-height: 0.9;
    text-shadow: 
        0 2px 0 var(--gold-dark),
        0 4px 0 rgba(0,0,0,0.3),
        0 0 60px var(--gold-glow);
}

.title-twisted {
    font-family: var(--font-title);
    font-size: clamp(2rem, 8vw, 3rem);
    color: var(--red-primary);
    letter-spacing: 0.3em;
    margin-top: -5px;
    text-shadow: 
        0 0 20px var(--red-glow),
        0 2px 0 rgba(0,0,0,0.5);
}

.tagline {
    font-family: var(--font-typewriter);
    font-size: 1rem;
    color: var(--cream-muted);
    text-align: center;
    margin-bottom: 40px;
    letter-spacing: 0.05em;
}

.divider {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 35px;
}

.divider-line {
    width: 50px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold-primary), transparent);
}

.divider-star {
    color: var(--gold-primary);
    font-size: 0.8rem;
}

/* Buttons */
.btn {
    font-family: var(--font-body);
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    -webkit-tap-highlight-color: transparent;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-primary {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    width: 100%;
    padding: 18px 30px;
    font-size: 1.1rem;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
    border-radius: 4px;
    box-shadow: 0 4px 15px var(--gold-glow), inset 0 1px 0 rgba(255,255,255,0.2);
    margin-bottom: 12px;
}

@media (hover: hover) {
    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px var(--gold-glow), inset 0 1px 0 rgba(255,255,255,0.2);
    }
}

.btn-primary:active { transform: translateY(0); }

.btn-primary svg { width: 22px; height: 22px; }

.btn-daily {
    background: linear-gradient(135deg, var(--bg-card), var(--bg-elevated));
    border: 2px solid var(--gold-dark);
    color: var(--gold-light);
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

@media (hover: hover) {
    .btn-daily:hover:not(:disabled) {
        border-color: var(--gold-primary);
        box-shadow: 0 6px 20px var(--gold-glow);
    }
}

.btn-secondary {
    width: 100%;
    padding: 14px 24px;
    font-size: 0.9rem;
    background: transparent;
    color: var(--cream-muted);
    border: 1px solid var(--text-muted);
    border-radius: 4px;
}

@media (hover: hover) {
    .btn-secondary:hover {
        border-color: var(--cream-muted);
        color: var(--cream);
    }
}

.menu-row {
    display: flex;
    gap: 12px;
    margin-top: 12px;
}

.btn-half {
    flex: 1;
}

.btn-quit {
    width: 36px;
    height: 36px;
    padding: 0;
    background: var(--bg-elevated);
    color: var(--cream-muted);
    border-radius: 50%;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-quit:hover {
    background: var(--red-primary);
    color: var(--cream);
}

/* Daily Quote - Premium Styling */
.daily-quote-container {
    margin-top: 50px;
    padding-top: 30px;
    border-top: 1px solid rgba(212, 168, 83, 0.2);
    text-align: center;
}

.daily-quote {
    font-family: var(--font-display);
    font-style: italic;
    font-weight: 500;
    font-size: 1.15rem;
    color: rgba(212, 168, 83, 0.9);
    line-height: 1.7;
    letter-spacing: 0.03em;
    margin-bottom: 12px;
}

.daily-quote-source {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--cream-muted);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    font-weight: 500;
}

/* ============================================
   CATEGORY SCREEN
   ============================================ */

#categoryScreen {
    background: var(--bg-deep);
    padding: 20px;
    overflow-y: auto;
}

.category-header {
    text-align: center;
    margin-bottom: 30px;
    padding-top: 20px;
}

.category-header h2 {
    font-family: var(--font-display);
    font-size: 2rem;
    color: var(--cream);
    margin-bottom: 8px;
}

.category-header p {
    font-size: 0.9rem;
    color: var(--text-muted);
}

.category-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    max-width: 500px;
    margin: 0 auto 100px;
}

.category-card {
    background: var(--bg-card);
    border: 2px solid var(--bg-elevated);
    border-radius: 12px;
    padding: 25px 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    -webkit-tap-highlight-color: transparent;
}

@media (hover: hover) {
    .category-card:hover {
        border-color: var(--gold-dark);
        transform: translateY(-2px);
    }
}

.category-card:active {
    transform: scale(0.98);
}

.category-card.selected {
    border-color: var(--gold-primary);
    box-shadow: 0 0 20px var(--gold-glow);
}

.category-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 12px;
    color: var(--gold-primary);
}

.category-icon svg {
    width: 100%;
    height: 100%;
    fill: currentColor;
}

.category-name {
    font-family: var(--font-title);
    font-size: 1.2rem;
    color: var(--cream);
    letter-spacing: 0.1em;
    margin-bottom: 5px;
}

.category-count {
    font-size: 0.75rem;
    color: var(--text-muted);
    display: none;
}

.category-actions {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    background: linear-gradient(to top, var(--bg-deep) 80%, transparent);
    display: flex;
    gap: 12px;
    max-width: 500px;
    margin: 0 auto;
}

.category-actions .btn {
    flex: 1;
    padding: 16px 24px;
    border-radius: 6px;
    font-size: 0.95rem;
}

.btn-back {
    background: var(--bg-elevated);
    color: var(--cream-muted);
}

.btn-start {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
    box-shadow: 0 4px 15px var(--gold-glow);
}

.btn-start:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none;
}

/* ============================================
   GAME SCREEN
   ============================================ */

#gameScreen {
    background: var(--bg-deep);
}

.game-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: var(--bg-dark);
    border-bottom: 1px solid rgba(212, 168, 83, 0.2);
}

.game-logo {
    font-family: var(--font-display);
    font-size: 1.2rem;
    color: var(--gold-primary);
}

.game-stats {
    display: flex;
    gap: 25px;
}

.game-stat { text-align: center; }

.game-stat-label {
    font-size: 0.6rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.game-stat-value {
    font-family: var(--font-title);
    font-size: 1.3rem;
    color: var(--cream);
}

.game-stat-value.points { color: var(--gold-light); }

.strikes-display {
    display: flex;
    gap: 4px;
}

.strike-pip {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--red-primary);
    box-shadow: 0 0 8px var(--red-glow);
    transition: all 0.3s ease;
}

.strike-pip.used {
    background: var(--bg-elevated);
    box-shadow: none;
}

.game-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 15px;
    gap: 15px;
    overflow-y: auto;
}

/* Progress */
.progress-track {
    display: flex;
    gap: 8px;
}

.progress-pip {
    width: 12px;
    height: 4px;
    border-radius: 2px;
    background: var(--bg-elevated);
    transition: all 0.3s ease;
}

.progress-pip.complete { background: var(--gold-primary); }

.progress-pip.current {
    background: var(--gold-light);
    box-shadow: 0 0 10px var(--gold-glow);
    width: 24px;
}

/* Clue Card */
.clue-card {
    width: 100%;
    max-width: 500px;
    background: var(--bg-card);
    border: 1px solid rgba(212, 168, 83, 0.3);
    border-radius: 8px;
    padding: 25px 20px;
    position: relative;
    box-shadow: var(--shadow-deep);
}

.clue-card::before {
    content: '‚òÖ NOW SHOWING ‚òÖ';
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-title);
    font-size: 0.75rem;
    color: var(--gold-primary);
    background: var(--bg-deep);
    padding: 4px 16px;
    letter-spacing: 0.2em;
}

.clue-text {
    font-family: var(--font-typewriter);
    font-size: 1.15rem;
    line-height: 1.6;
    text-align: center;
    color: var(--cream);
}

.clue-category {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 15px;
    padding-top: 12px;
    border-top: 1px solid rgba(212, 168, 83, 0.15);
    font-size: 0.8rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.15em;
}

/* Points Pot */
.points-pot {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 10px 20px;
    background: var(--bg-card);
    border: 1px solid rgba(212, 168, 83, 0.3);
    border-radius: 50px;
}

.pot-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
}

.pot-value {
    font-family: var(--font-display);
    font-size: 1.4rem;
    color: var(--gold-light);
    text-shadow: 0 0 15px var(--gold-glow);
    min-width: 50px;
    text-align: center;
}

.pot-multiplier {
    font-size: 0.75rem;
    color: var(--green-correct);
    font-weight: 600;
}

.pot-value.dropping {
    animation: potDrop 0.3s ease;
}

@keyframes potDrop {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); color: var(--red-light); }
}

/* Title Reveal */
.title-reveal {
    width: 100%;
    max-width: 500px;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    background: var(--bg-dark);
    border: 1px solid var(--gold-dark);
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(212, 168, 83, 0.1);
}

.title-letters {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 4px;
    font-family: var(--font-title);
    font-size: clamp(1.3rem, 5vw, 1.8rem);
    letter-spacing: 0.05em;
}

.letter-slot {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 0.7em;
    color: var(--gold-light);
    transition: all 0.3s ease;
}

.letter-slot.hidden { color: var(--text-muted); }

.letter-slot.revealed {
    animation: letterReveal 0.4s ease;
}

.letter-slot.space { width: 0.5em; }

@keyframes letterReveal {
    0% { transform: scale(1.5) rotateX(90deg); opacity: 0; }
    100% { transform: scale(1) rotateX(0); opacity: 1; }
}

/* On-Screen Keyboard */
.keyboard {
    width: 100%;
    max-width: 540px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 12px 8px;
    background: var(--bg-card);
    border: 1px solid var(--gold-dark);
    border-radius: 8px;
    box-shadow: 0 0 20px rgba(212, 168, 83, 0.1);
}

.keyboard-row {
    display: flex;
    justify-content: center;
    gap: 5px;
}

.key {
    flex: 1;
    max-width: 42px;
    min-width: 32px;
    height: 46px;
    padding: 0;
    font-family: var(--font-body);
    font-size: 1.05rem;
    font-weight: 600;
    background: var(--bg-dark);
    color: var(--gold-light);
    border: 1px solid var(--gold-dark);
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Only apply hover on devices that support it */
@media (hover: hover) {
    .key:hover:not(:disabled) {
        border-color: var(--gold-primary);
        background: var(--bg-elevated);
        transform: translateY(-2px);
    }
}

.key:active:not(:disabled) {
    transform: translateY(0);
    background: var(--bg-elevated);
}

.key:disabled {
    cursor: not-allowed;
    opacity: 0.4;
}

.key.correct {
    background: var(--gold-primary);
    border-color: var(--gold-primary);
    color: var(--bg-deep);
    box-shadow: 0 0 10px var(--gold-glow);
}

.key.incorrect {
    background: var(--bg-elevated);
    border-color: var(--text-muted);
    opacity: 0.4;
    color: var(--cream-muted);
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 10px;
    width: 100%;
    max-width: 500px;
}

.btn-giveup {
    flex: 1;
    padding: 14px 16px;
    font-size: 0.85rem;
    background: var(--bg-elevated);
    color: var(--cream);
    border-radius: 6px;
    border: 1px solid var(--text-muted);
}

.btn-giveup:hover:not(:disabled) {
    background: var(--bg-card);
    border-color: var(--cream-muted);
}

.btn-giveup:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.btn-solve {
    flex: 2;
    padding: 14px 20px;
    font-size: 0.9rem;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
    border-radius: 6px;
    box-shadow: 0 4px 15px var(--gold-glow);
}

.btn-solve:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--gold-glow);
}

.btn-solve:active { transform: translateY(0); }

.btn-solve:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none;
}

/* ============================================
   DAILY CHALLENGE SCREEN
   ============================================ */

#dailyScreen {
    background: var(--bg-deep);
}

.daily-header {
    text-align: center;
    padding: 20px;
    background: var(--bg-dark);
    border-bottom: 1px solid rgba(212, 168, 83, 0.2);
}

.daily-header h2 {
    font-family: var(--font-display);
    font-size: 1.5rem;
    color: var(--gold-light);
    margin-bottom: 5px;
}

.daily-date {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.daily-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 25px 20px;
    gap: 20px;
    overflow-y: auto;
}

.daily-clue-card {
    width: 100%;
    max-width: 500px;
    background: var(--bg-card);
    border: 1px solid rgba(212, 168, 83, 0.3);
    border-radius: 8px;
    padding: 30px 25px;
    position: relative;
    box-shadow: var(--shadow-deep);
}

.daily-clue-card::before {
    content: attr(data-question);
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-title);
    font-size: 0.75rem;
    color: var(--gold-primary);
    background: var(--bg-deep);
    padding: 4px 16px;
    letter-spacing: 0.2em;
}

.daily-input-container {
    width: 100%;
    max-width: 500px;
}

.daily-input {
    width: 100%;
    padding: 16px;
    font-family: var(--font-body);
    font-size: 1.1rem;
    background: var(--bg-dark);
    border: 1px solid var(--gold-dark);
    border-radius: 8px;
    color: var(--gold-light);
    text-align: center;
    box-shadow: 0 0 15px rgba(212, 168, 83, 0.1);
}

.daily-input:focus {
    outline: none;
    border-color: var(--gold-primary);
    box-shadow: 0 0 20px rgba(212, 168, 83, 0.2);
}

.daily-input::placeholder { color: var(--text-muted); }

.daily-input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.daily-actions {
    display: flex;
    gap: 12px;
    width: 100%;
    max-width: 500px;
}

.daily-actions .btn {
    flex: 1;
    padding: 16px 24px;
    border-radius: 6px;
}

.btn-skip {
    background: var(--bg-elevated);
    color: var(--cream-muted);
}

.btn-submit-daily {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
}

/* Daily Results */
#dailyResultsScreen {
    background: 
        radial-gradient(ellipse at 50% 30%, rgba(212, 168, 83, 0.1) 0%, transparent 50%),
        var(--bg-deep);
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.daily-results-card {
    text-align: center;
    max-width: 400px;
    width: 100%;
}

.daily-results-title {
    font-family: var(--font-display);
    font-size: 1.8rem;
    color: var(--gold-light);
    margin-bottom: 10px;
}

.daily-results-date {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 20px;
}

.daily-score-display {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 10px;
}

.daily-star {
    font-size: 2rem;
    transition: all 0.3s ease;
}

.daily-star.earned {
    color: var(--gold-light);
    text-shadow: 0 0 15px var(--gold-glow);
}

.daily-star.empty {
    color: var(--text-muted);
    opacity: 0.3;
}

.daily-score-text {
    font-family: var(--font-title);
    font-size: 1.5rem;
    color: var(--cream);
    letter-spacing: 0.1em;
    margin-bottom: 30px;
}

.daily-breakdown {
    background: var(--bg-card);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 25px;
    border: 1px solid rgba(212, 168, 83, 0.2);
    max-height: 180px;
    overflow-y: auto;
}

.daily-breakdown-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 5px;
    border-bottom: 1px solid var(--bg-elevated);
    font-size: 0.85rem;
}

.daily-breakdown-row:last-child { border-bottom: none; }

.daily-breakdown-result {
    font-size: 1.2rem;
}

.daily-results-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.daily-results-actions .btn {
    width: 100%;
    padding: 16px 24px;
    border-radius: 6px;
}

.daily-next-puzzle {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-top: 20px;
}

/* ============================================
   MODALS
   ============================================ */

.modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    align-items: center;
    justify-content: center;
    z-index: 100;
    padding: 20px;
}

.modal-overlay.active { display: flex; }

.solve-modal {
    background: var(--bg-card);
    border: 1px solid var(--gold-dark);
    border-radius: 12px;
    padding: 30px;
    width: 100%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 0 30px rgba(212, 168, 83, 0.15);
}

.solve-modal h3 {
    font-family: var(--font-display);
    font-size: 1.5rem;
    color: var(--gold-light);
    margin-bottom: 20px;
}

.solve-input {
    width: 100%;
    padding: 16px;
    font-family: var(--font-body);
    font-size: 1.1rem;
    background: var(--bg-dark);
    border: 1px solid var(--gold-dark);
    border-radius: 8px;
    color: var(--gold-light);
    text-align: center;
    margin-bottom: 20px;
    box-shadow: 0 0 15px rgba(212, 168, 83, 0.1);
}

.solve-input:focus {
    outline: none;
    border-color: var(--gold-primary);
    box-shadow: 0 0 20px rgba(212, 168, 83, 0.2);
}

.solve-input::placeholder {
    color: var(--text-muted);
}
}

.solve-input::placeholder { color: var(--text-muted); }

.solve-actions {
    display: flex;
    gap: 12px;
}

.solve-actions .btn {
    flex: 1;
    padding: 14px 20px;
    border-radius: 6px;
}

.btn-cancel {
    background: var(--bg-elevated);
    color: var(--cream-muted);
}

.btn-submit {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
}

/* Result Overlay */
.result-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    align-items: center;
    justify-content: center;
    z-index: 100;
    padding: 20px;
}

.result-overlay.active { display: flex; }

.result-card {
    text-align: center;
    max-width: 400px;
    position: relative;
}

.result-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    animation: resultPop 0.5s ease;
}

@keyframes resultPop {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.result-title {
    font-family: var(--font-display);
    font-size: 2rem;
    margin-bottom: 10px;
}

.result-title.correct {
    color: var(--gold-light);
    text-shadow: 0 0 30px var(--gold-glow);
}

.result-title.incorrect { color: var(--red-light); }

.result-movie {
    font-family: var(--font-title);
    font-size: 1.6rem;
    color: var(--cream);
    letter-spacing: 0.1em;
    margin-bottom: 10px;
}

.result-points {
    font-size: 1rem;
    color: var(--gold-primary);
    margin-bottom: 30px;
}

.result-points.zero { color: var(--text-muted); }

.btn-continue {
    padding: 16px 50px;
    font-size: 1rem;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
    border-radius: 6px;
    box-shadow: 0 4px 15px var(--gold-glow);
}

/* Celebration effect */
.result-card.celebrate::before {
    content: '‚ú®';
    position: absolute;
    font-size: 2rem;
    animation: sparkle 0.6s ease-out forwards;
    top: 20%;
    left: 20%;
}

.result-card.celebrate::after {
    content: '‚ú®';
    position: absolute;
    font-size: 2rem;
    animation: sparkle 0.6s ease-out 0.1s forwards;
    top: 20%;
    right: 20%;
}

@keyframes sparkle {
    0% { opacity: 0; transform: scale(0) rotate(0deg); }
    50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
    100% { opacity: 0; transform: scale(0.5) rotate(360deg) translateY(-30px); }
}

/* ============================================
   GAME OVER SCREEN
   ============================================ */

#gameOverScreen {
    background: 
        radial-gradient(ellipse at 50% 30%, rgba(212, 168, 83, 0.1) 0%, transparent 50%),
        var(--bg-deep);
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.game-over-card {
    text-align: center;
    max-width: 400px;
    width: 100%;
}

.final-score-label {
    font-family: var(--font-title);
    font-size: 1rem;
    color: var(--text-muted);
    letter-spacing: 0.3em;
    margin-bottom: 10px;
}

.final-score {
    font-family: var(--font-display);
    font-size: 5rem;
    color: var(--gold-light);
    text-shadow: 0 0 40px var(--gold-glow);
    line-height: 1;
    margin-bottom: 5px;
}

.final-score-subtitle {
    font-size: 1rem;
    color: var(--cream-muted);
    margin-bottom: 40px;
}

.final-breakdown {
    background: var(--bg-card);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid rgba(212, 168, 83, 0.2);
    max-height: 200px;
    overflow-y: auto;
}

.breakdown-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--bg-elevated);
    font-size: 0.9rem;
}

.breakdown-row:last-child { border-bottom: none; }

.breakdown-title { color: var(--cream); }

.breakdown-points {
    font-family: var(--font-title);
    font-size: 1rem;
}

.breakdown-points.earned { color: var(--gold-primary); }
.breakdown-points.missed { color: var(--text-muted); }

.game-over-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.game-over-actions .btn {
    width: 100%;
    padding: 16px 24px;
    border-radius: 6px;
}

.btn-play-again {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
    color: var(--bg-deep);
    font-size: 1rem;
}

.btn-share {
    background: var(--bg-elevated);
    color: var(--cream);
    border: 1px solid var(--gold-dark);
}

.btn-menu {
    background: transparent;
    color: var(--cream-muted);
    border: 1px solid var(--text-muted);
}

/* ============================================
   HOW TO PLAY SCREEN
   ============================================ */

#howToPlayScreen {
    background: var(--bg-deep);
    padding: 20px;
    overflow-y: auto;
}

.how-to-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 30px;
    padding-top: 10px;
}

.how-to-header h2 {
    font-family: var(--font-display);
    font-size: 1.8rem;
    color: var(--cream);
}

.btn-back-small {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--bg-card);
    color: var(--cream);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    border: none;
    cursor: pointer;
}

.how-to-content {
    max-width: 500px;
    margin: 0 auto;
}

.how-to-section {
    margin-bottom: 30px;
}

.how-to-section h3 {
    font-family: var(--font-title);
    font-size: 1.1rem;
    color: var(--gold-primary);
    letter-spacing: 0.1em;
    margin-bottom: 10px;
}

.how-to-section p {
    color: var(--cream-muted);
    line-height: 1.7;
    font-size: 0.95rem;
}

/* Settings Screen */
.settings-content {
    max-width: 500px;
    margin: 0 auto;
    padding: 0 20px;
}

.settings-section {
    margin-bottom: 30px;
}

.settings-section h3 {
    font-family: var(--font-title);
    font-size: 0.9rem;
    color: var(--text-muted);
    letter-spacing: 0.15em;
    margin-bottom: 15px;
    text-transform: uppercase;
}

.setting-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--bg-card);
    border-radius: 8px;
    margin-bottom: 10px;
}

.setting-info {
    flex: 1;
}

.setting-label {
    font-weight: 500;
    color: var(--cream);
    margin-bottom: 3px;
}

.setting-desc {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.toggle {
    width: 50px;
    height: 28px;
    background: var(--bg-elevated);
    border-radius: 14px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s ease;
}

.toggle.active {
    background: var(--gold-primary);
}

.toggle::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: 22px;
    height: 22px;
    background: var(--cream);
    border-radius: 50%;
    transition: transform 0.2s ease;
}

.toggle.active::after {
    transform: translateX(22px);
}

#roastModeSelect {
    padding: 8px 12px;
    font-family: var(--font-body);
    font-size: 0.9rem;
    background: var(--bg-elevated);
    color: var(--cream);
    border: 1px solid var(--text-muted);
    border-radius: 6px;
    cursor: pointer;
}

.btn-reset {
    padding: 10px 20px;
    font-size: 0.85rem;
    background: var(--red-primary);
    color: var(--cream);
    border-radius: 6px;
}

.btn-reset:hover {
    background: var(--red-light);
}

.settings-about {
    color: var(--cream-muted);
    font-size: 0.9rem;
}

.settings-about a {
    color: var(--gold-primary);
    text-decoration: none;
}

.settings-about a:hover {
    text-decoration: underline;
}

/* Loading State */
.loading-overlay {
    position: fixed;
    inset: 0;
    background: var(--bg-deep);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    flex-direction: column;
    gap: 20px;
}

.loading-overlay.hidden {
    display: none;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid var(--bg-elevated);
    border-top-color: var(--gold-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-text {
    font-family: var(--font-typewriter);
    color: var(--cream-muted);
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.fade-in { animation: fadeIn 0.4s ease forwards; }

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-8px); }
    40%, 80% { transform: translateX(8px); }
}

.shake { animation: shake 0.4s ease; }
    </style>
</head>
<body>
    <div class="film-grain"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading clues...</div>
    </div>

    <!-- START SCREEN -->
    <div id="startScreen" class="screen active">
        <div class="spotlight"></div>
        <div class="spotlight-secondary"></div>
        <div class="home-content">
            <div class="main-title">
                <div class="title-spotlight"></div>
                <div class="title-plot">PLOT</div>
                <div class="title-twisted">TWISTED</div>
            </div>
            <p class="tagline">Guess the movie from the twisted summary</p>
            <div class="divider">
                <span class="divider-line"></span>
                <span class="divider-star">‚òÖ</span>
                <span class="divider-line"></span>
            </div>
            <button class="btn btn-primary" id="quickPlayBtn" disabled>
                <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M8 5v14l11-7z"/></svg>
                Quick Play
            </button>
            <button class="btn btn-primary btn-daily" id="dailyBtn" disabled>
                <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
                Daily Challenge
            </button>
            <div class="menu-row">
                <button class="btn btn-secondary btn-half" id="howToPlayBtn">How to Play</button>
                <button class="btn btn-secondary btn-half" id="settingsBtn">Settings</button>
            </div>
            <div class="daily-quote-container">
                <div class="daily-quote" id="dailyQuote"></div>
                <div class="daily-quote-source" id="dailyQuoteSource"></div>
            </div>
        </div>
    </div>

    <!-- CATEGORY SCREEN -->
    <div id="categoryScreen" class="screen">
        <div class="category-header">
            <h2>Choose Your Genre</h2>
            <p>Pick a category to start playing</p>
        </div>
        <div class="category-grid" id="categoryGrid"></div>
        <div class="category-actions">
            <button class="btn btn-back" id="categoryBackBtn">Back</button>
            <button class="btn btn-start" id="startGameBtn" disabled>Start</button>
        </div>
    </div>

    <!-- HOW TO PLAY SCREEN -->
    <div id="howToPlayScreen" class="screen">
        <div class="how-to-header">
            <button class="btn-back-small" id="howToBackBtn">‚Üê</button>
            <h2>How to Play</h2>
        </div>
        <div class="how-to-content">
            <div class="how-to-section">
                <h3>üé¨ The Goal</h3>
                <p>Read the twisted (but technically accurate) plot summary and guess the movie title. Use the keyboard to guess letters, or go for the full solve!</p>
            </div>
            <div class="how-to-section">
                <h3>üí∞ Scoring</h3>
                <p>Each movie starts at 500 points. Wrong consonant guesses cost 30 points (vowels are free!). Solve early with more letters hidden for bonus multipliers (1.5x or 1.25x)!</p>
            </div>
            <div class="how-to-section">
                <h3>‚ùå Strikes</h3>
                <p>You have 3 strikes for the entire game. Wrong full solve attempts cost a strike. Run out and it's game over!</p>
            </div>
            <div class="how-to-section">
                <h3>üìÖ Daily Challenge</h3>
                <p>Same 5 movies for everyone, one guess per movie, no hints. Compare your score with friends!</p>
            </div>
        </div>
    </div>

    <!-- SETTINGS SCREEN -->
    <div id="settingsScreen" class="screen">
        <div class="how-to-header">
            <button class="btn-back-small" id="settingsBackBtn">‚Üê</button>
            <h2>Settings</h2>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <h3>Game Options</h3>
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-label">Sound Effects</div>
                        <div class="setting-desc">Play sounds for correct/incorrect</div>
                    </div>
                    <div class="toggle" id="soundToggle"></div>
                </div>
                <div class="setting-row">
                    <div class="setting-info">
                        <label class="setting-label" for="roastModeSelect">Roast Intensity</label>
                        <div class="setting-desc">Choose how spicy the feedback gets</div>
                    </div>
                    <select id="roastModeSelect">
                        <option value="clean">Clean</option>
                        <option value="spicy">Spicy</option>
                        <option value="nsfw">NSFW</option>
                    </select>
                </div>
            </div>
            <div class="settings-section">
                <h3>Data</h3>
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-label">Reset Progress</div>
                        <div class="setting-desc">Clear all stats and seen clues</div>
                    </div>
                    <button class="btn btn-reset" id="resetBtn">Reset</button>
                </div>
            </div>
            <div class="settings-section">
                <h3>About</h3>
                <p class="settings-about">Created by <a href="https://x.com/Ben_Soup" target="_blank">Ben Campbell</a></p>
            </div>
        </div>
    </div>

    <!-- GAME SCREEN (Quick Play) -->
    <div id="gameScreen" class="screen">
        <div class="game-header">
            <div class="game-logo">Plot Twisted</div>
            <div class="game-stats">
                <div class="game-stat">
                    <div class="game-stat-label">Score</div>
                    <div class="game-stat-value points" id="totalScore">0</div>
                </div>
                <div class="game-stat">
                    <div class="game-stat-label">Strikes</div>
                    <div class="strikes-display" id="strikesDisplay">
                        <div class="strike-pip"></div>
                        <div class="strike-pip"></div>
                        <div class="strike-pip"></div>
                    </div>
                </div>
            </div>
            <button class="btn btn-quit" id="quitBtn">‚úï</button>
        </div>
        <div class="game-content">
            <div class="progress-track" id="progressTrack"></div>
            <div class="clue-card fade-in" id="clueCard">
                <div class="clue-text" id="clueText"></div>
                <div class="clue-category" id="clueCategory"></div>
            </div>
            <div class="points-pot">
                <span class="pot-label">Worth</span>
                <span class="pot-value" id="potValue">500</span>
                <span class="pot-multiplier" id="potMultiplier"></span>
            </div>
            <div class="title-reveal" id="titleReveal">
                <div class="title-letters" id="titleLetters"></div>
            </div>
            <div class="keyboard" id="keyboard"></div>
            <div class="action-buttons">
                <button class="btn btn-giveup" id="giveUpBtn">Give Up</button>
                <button class="btn btn-solve" id="solveBtn">I Know It!</button>
            </div>
        </div>
    </div>

    <!-- DAILY CHALLENGE SCREEN -->
    <div id="dailyScreen" class="screen">
        <div class="daily-header">
            <h2>Daily Challenge</h2>
            <div class="daily-date" id="dailyDateDisplay"></div>
        </div>
        <div class="daily-content">
            <div class="progress-track" id="dailyProgressTrack"></div>
            <div class="daily-clue-card" id="dailyClueCard" data-question="MOVIE 1 OF 5">
                <div class="clue-text" id="dailyClueText"></div>
            </div>
            <div class="daily-input-container">
                <input type="text" class="daily-input" id="dailyInput" placeholder="Type your guess..." autocomplete="off" autocapitalize="off">
            </div>
            <div class="daily-actions">
                <button class="btn btn-skip" id="dailySkipBtn">Skip</button>
                <button class="btn btn-submit-daily" id="dailySubmitBtn">Submit</button>
            </div>
        </div>
    </div>

    <!-- DAILY RESULTS SCREEN -->
    <div id="dailyResultsScreen" class="screen">
        <div class="daily-results-card">
            <div class="daily-results-title">Daily Challenge Complete!</div>
            <div class="daily-results-date" id="dailyResultsDate"></div>
            <div class="daily-score-display" id="dailyScoreDisplay"></div>
            <div class="daily-score-text" id="dailyScoreText">3/5 Correct ‚Ä¢ 300 pts</div>
            <div class="daily-breakdown" id="dailyBreakdown"></div>
            <div class="daily-results-actions">
                <button class="btn btn-share" id="dailyShareBtn">Share Results</button>
                <button class="btn btn-menu" id="dailyMenuBtn">Main Menu</button>
            </div>
            <div class="daily-next-puzzle" id="dailyNextPuzzle">Next puzzle in 12:34:56</div>
        </div>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="gameOverScreen" class="screen">
        <div class="game-over-card">
            <div class="final-score-label">FINAL SCORE</div>
            <div class="final-score" id="finalScore">0</div>
            <div class="final-score-subtitle" id="finalSubtitle">5 of 5 movies solved</div>
            <div class="final-breakdown" id="finalBreakdown"></div>
            <div class="game-over-actions">
                <button class="btn btn-play-again" id="playAgainBtn">Play Again</button>
                <button class="btn btn-share" id="shareBtn">Share Score</button>
                <button class="btn btn-menu" id="menuBtn">Main Menu</button>
            </div>
        </div>
    </div>

    <!-- SOLVE MODAL -->
    <div class="modal-overlay" id="solveModal">
        <div class="solve-modal">
            <h3>What's the movie?</h3>
            <input type="text" class="solve-input" id="solveInput" placeholder="Type your answer..." autocomplete="off" autocapitalize="off">
            <div class="solve-actions">
                <button class="btn btn-cancel" id="cancelSolveBtn">Cancel</button>
                <button class="btn btn-submit" id="submitSolveBtn">Submit</button>
            </div>
        </div>
    </div>

    <!-- QUIT CONFIRMATION MODAL -->
    <div class="modal-overlay" id="quitModal">
        <div class="solve-modal">
            <h3>Quit Game?</h3>
            <p style="color: var(--cream-muted); margin-bottom: 20px;">Your progress will be lost.</p>
            <div class="solve-actions">
                <button class="btn btn-cancel" id="cancelQuitBtn">Cancel</button>
                <button class="btn btn-submit" id="confirmQuitBtn">Quit</button>
            </div>
        </div>
    </div>

    <!-- RESULT OVERLAY -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-card">
            <div class="result-icon" id="resultIcon">üé¨</div>
            <div class="result-title" id="resultTitle">Correct!</div>
            <div class="result-movie" id="resultMovie">TITANIC</div>
            <div class="result-points" id="resultPoints">+500 points</div>
            <button class="btn btn-continue" id="continueBtn">Continue</button>
        </div>
    </div>

<script>
// ============================================
// SVG ICONS FOR CATEGORIES
// ============================================

const CATEGORY_ICONS = {
    "Family": `<svg viewBox="0 0 48 48" fill="currentColor"><path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 30l-8-8 2.83-2.83L22 28.34l13.17-13.17L38 18 22 34z" opacity="0"/><path d="M35 16c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.86 1.03 3.47 2.54 4.33L24 28l-3.54-7.67C21.97 19.47 23 17.86 23 16c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.86 1.03 3.47 2.54 4.33L8 38h32L32.46 20.33C33.97 19.47 35 17.86 35 16zM18 14c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm6 20l3-8 3 8H24zm6-18c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/></svg>`,
    "Sci-Fi": `<svg viewBox="0 0 48 48" fill="currentColor"><path d="M24 2L4 14v20l20 12 20-12V14L24 2zm0 4.5l14 8.4v15.2l-14 8.4-14-8.4V14.9l14-8.4zM24 16c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/></svg>`,
    "Fantasy": `<svg viewBox="0 0 48 48" fill="currentColor"><path d="M24 4l-6 18h-14l11.5 8.5-4.5 13.5 13-9.5 13 9.5-4.5-13.5L44 22H30L24 4z"/></svg>`,
    "Superhero": `<svg viewBox="0 0 48 48" fill="currentColor"><path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 6c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 28c-5.52 0-10.29-3.23-12.54-7.9.06-4.15 8.36-6.43 12.54-6.43s12.48 2.28 12.54 6.43C33.29 34.77 29.52 38 24 38z"/><path d="M15 20l-3 4 6 2-3-6zm18 0l-3 6 6-2-3-4z"/></svg>`,
    "Emotional Damage": `<svg viewBox="0 0 48 48" fill="currentColor"><path d="M24 44l-2.5-2.27C10.3 31.52 4 25.79 4 18.5 4 12.42 8.42 8 14.5 8c3.43 0 6.73 1.6 8.86 4.11L24 12.8l.64-.69C26.77 9.6 30.07 8 33.5 8 39.58 8 44 12.42 44 18.5c0 7.29-6.3 13.02-17.5 23.23L24 44z"/><path d="M19 22l5 5 5-5" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/></svg>`,
    "Streaming Hits": `<svg viewBox="0 0 48 48" fill="currentColor"><rect x="6" y="10" width="36" height="24" rx="2" fill="none" stroke="currentColor" stroke-width="3"/><path d="M20 18v8l7-4-7-4z"/><line x1="16" y1="38" x2="32" y2="38" stroke="currentColor" stroke-width="3" stroke-linecap="round"/></svg>`
};

const DAILY_QUOTES = [
    { quote: "Every great film should seem new every time you see it.", source: "Roger Ebert" },
    { quote: "Cinema is a matter of what's in the frame and what's out.", source: "Martin Scorsese" },
    { quote: "A film is never really good unless the camera is an eye in the head of a poet.", source: "Orson Welles" },
    { quote: "Movies are like an expensive form of therapy for me.", source: "Tim Burton" },
    { quote: "The cinema is truth twenty-four times per second.", source: "Jean-Luc Godard" },
    { quote: "Film lovers are sick people.", source: "Fran√ßois Truffaut" },
    { quote: "I don't dream at night, I dream all day; I dream for a living.", source: "Steven Spielberg" },
    { quote: "Cinema is the most beautiful fraud in the world.", source: "Jean-Luc Godard" },
    { quote: "A story should have a beginning, a middle and an end, but not necessarily in that order.", source: "Jean-Luc Godard" },
    { quote: "Every single movie is a miracle.", source: "Guillermo del Toro" },
    { quote: "The length of a film should be directly related to the endurance of the human bladder.", source: "Alfred Hitchcock" },
    { quote: "If it can be written, or thought, it can be filmed.", source: "Stanley Kubrick" }
];

// ============================================
// COMMENTARY BANK
// ============================================

const PRAISE_MESSAGES = {
    clean: [
        "You guessed that like you've seen it 47 times.",
        "Cinema brain activated. Nice pull.",
        "Textbook. If there were a textbook for this.",
        "Critics could never compete with that recall.",
        "That was so fast I'm checking for spoilers.",
        "Someone's been paying attention.",
        "You didn't guess. You remembered.",
        "Award-winning stuff right there.",
        "Your movie memory is doing heavy lifting.",
        "That answer landed smooth.",
        "Perfect answer. Somewhere a director feels validated.",
        "You didn't even hesitate. Iconic.",
        "If this were trivia night, you'd be buying snacks.",
        "Main-character-energy accurate.",
        "You saw the clue and said 'I know that trauma.'"
    ],
    spicy: [
        "Okay, film buff. Touch grass later, maybe?",
        "How many times have you rewatched this?",
        "Your brain is 70% water, 30% movie quotes.",
        "That was suspiciously fast. Are you the director?",
        "You got that right like it emotionally damaged you.",
        "Your recall is terrifying. Join my trivia team.",
        "You really said 'Oh, that's my Roman Empire.'",
        "The way you snapped that answer out‚Ä¶ stay dangerous.",
        "Some people have hobbies; you have this.",
        "If wrong answers were streaming, you'd be trending."
    ],
    nsfw: [
        "Well damn, you didn't even let the clue breathe.",
        "You smoked that answer like it owed you money.",
        "Okay Rotten Tomatoes, we get it.",
        "That was so fast it felt illegal.",
        "You didn't guess. You absolutely knew. Terrifying.",
        "That answer was feral-level correct.",
        "You cooked that. No notes. Unhinged talent.",
        "If knowledge is power, you're one bad day from villain.",
        "You grabbed that answer by the throat.",
        "That was disrespectfully accurate."
    ]
};

const INSULT_MESSAGES = {
    clean: [
        "Strong start, wrong universe.",
        "Close, but the multiverse says no.",
        "That guess is going to the cutting room floor.",
        "Good energy, incorrect timeline.",
        "Bold of you to answer so wrong so fast.",
        "You aimed for Oscar season, landed in straight-to-DVD.",
        "Plot twist: that was not it.",
        "The vibes were there. The title was not.",
        "That answer needs a reboot.",
        "Wrong, but at least you committed."
    ],
    spicy: [
        "You didn't miss by a mile, you missed by a franchise.",
        "That answer belongs in a gas station bargain bin.",
        "Peak confidence, zero correctness.",
        "I see the vision, but the vision is blindfolded.",
        "If wrong answers were streaming, you'd be trending.",
        "You're not even in the same cinematic universe.",
        "Your answer has strong 'first draft' energy.",
        "You didn't just miss; you created a new genre of wrong."
    ],
    nsfw: [
        "That answer got dragged into the alley.",
        "That was so wrong I checked if we're playing the same game.",
        "Your guess just got ratio'd by the correct answer.",
        "That was straight-up disaster. Director-apologizes bad.",
        "The plot filed a restraining order.",
        "If wrong answers were crimes, you'd be wanted.",
        "You cooked that guess but the stove wasn't on.",
        "You fumbled so hard the bag went to orbit."
    ]
};

// ============================================
// GAME ENGINE
// ============================================

class PlotTwisted {
    constructor() {
        this.state = {
            currentScreen: 'start',
            selectedCategory: null,
            questions: [],
            currentIndex: 0,
            totalScore: 0,
            strikes: 3,
            currentPot: 500,
            revealedIndices: [],
            guessedLetters: [],
            results: [],
            seenClues: {},
            // Daily
            dailyQuestions: [],
            dailyIndex: 0,
            dailyResults: [],
            dailyCompleted: false
        };
        
        this.config = {
            maxPot: 500,
            wrongLetterCost: 30,
            minPot: 50,
            questionsPerRound: 5,
            fuzzyThreshold: 0.18
        };
        
        this.clueBank = null;
        this.settings = { sound: false, roastMode: 'clean' };
    }

    async init() {
        this.cacheDOM();
        this.bindEvents();
        this.loadSettings();
        this.loadSeenClues();
        
        await this.loadClueDatabase();
        
        this.loadDailyQuote();
        this.checkDailyStatus();
        this.showScreen('start');
    }
    
    async loadClueDatabase() {
        try {
            const response = await fetch('./clues.json');
            if (!response.ok) throw new Error('Failed to load clues');
            this.clueBank = await response.json();
            
            document.getElementById('quickPlayBtn').disabled = false;
            document.getElementById('dailyBtn').disabled = false;
            document.getElementById('loadingOverlay').classList.add('hidden');
            
            console.log('‚úÖ Clue database loaded:', Object.keys(this.clueBank));
        } catch (err) {
            console.error("‚ùå Clues failed to load:", err);
            document.querySelector('.loading-text').textContent = 'Failed to load. Please refresh.';
        }
    }

    cacheDOM() {
        this.screens = {
            start: document.getElementById('startScreen'),
            category: document.getElementById('categoryScreen'),
            howToPlay: document.getElementById('howToPlayScreen'),
            settings: document.getElementById('settingsScreen'),
            game: document.getElementById('gameScreen'),
            daily: document.getElementById('dailyScreen'),
            dailyResults: document.getElementById('dailyResultsScreen'),
            gameOver: document.getElementById('gameOverScreen')
        };
        
        this.dom = {
            categoryGrid: document.getElementById('categoryGrid'),
            startGameBtn: document.getElementById('startGameBtn'),
            clueText: document.getElementById('clueText'),
            clueCategory: document.getElementById('clueCategory'),
            clueCard: document.getElementById('clueCard'),
            titleLetters: document.getElementById('titleLetters'),
            potValue: document.getElementById('potValue'),
            potMultiplier: document.getElementById('potMultiplier'),
            totalScore: document.getElementById('totalScore'),
            strikesDisplay: document.getElementById('strikesDisplay'),
            progressTrack: document.getElementById('progressTrack'),
            keyboard: document.getElementById('keyboard'),
            giveUpBtn: document.getElementById('giveUpBtn'),
            solveBtn: document.getElementById('solveBtn'),
            solveModal: document.getElementById('solveModal'),
            solveInput: document.getElementById('solveInput'),
            quitModal: document.getElementById('quitModal'),
            resultOverlay: document.getElementById('resultOverlay'),
            resultIcon: document.getElementById('resultIcon'),
            resultTitle: document.getElementById('resultTitle'),
            resultMovie: document.getElementById('resultMovie'),
            resultPoints: document.getElementById('resultPoints'),
            continueBtn: document.getElementById('continueBtn'),
            soundToggle: document.getElementById('soundToggle'),
            roastModeSelect: document.getElementById('roastModeSelect'),
            finalScore: document.getElementById('finalScore'),
            finalSubtitle: document.getElementById('finalSubtitle'),
            finalBreakdown: document.getElementById('finalBreakdown'),
            dailyQuote: document.getElementById('dailyQuote'),
            dailyQuoteSource: document.getElementById('dailyQuoteSource'),
            resetBtn: document.getElementById('resetBtn'),
            // Daily
            dailyDateDisplay: document.getElementById('dailyDateDisplay'),
            dailyProgressTrack: document.getElementById('dailyProgressTrack'),
            dailyClueCard: document.getElementById('dailyClueCard'),
            dailyClueText: document.getElementById('dailyClueText'),
            dailyInput: document.getElementById('dailyInput'),
            dailySkipBtn: document.getElementById('dailySkipBtn'),
            dailySubmitBtn: document.getElementById('dailySubmitBtn'),
            dailyScoreDisplay: document.getElementById('dailyScoreDisplay'),
            dailyScoreText: document.getElementById('dailyScoreText'),
            dailyBreakdown: document.getElementById('dailyBreakdown'),
            dailyResultsDate: document.getElementById('dailyResultsDate'),
            dailyNextPuzzle: document.getElementById('dailyNextPuzzle')
        };
    }

    bindEvents() {
        // Start screen
        document.getElementById('quickPlayBtn').onclick = () => this.showCategoryScreen();
        document.getElementById('dailyBtn').onclick = () => this.startDaily();
        document.getElementById('howToPlayBtn').onclick = () => this.showScreen('howToPlay');
        document.getElementById('howToBackBtn').onclick = () => this.showScreen('start');
        document.getElementById('settingsBtn').onclick = () => this.showScreen('settings');
        document.getElementById('settingsBackBtn').onclick = () => this.showScreen('start');
        
        // Settings
        this.dom.soundToggle.onclick = () => this.toggleSound();
        this.dom.roastModeSelect?.addEventListener('change', (e) => this.handleRoastModeChange(e.target.value));
        this.dom.resetBtn?.addEventListener('click', () => this.resetProgress());
        
        // Category
        document.getElementById('categoryBackBtn').onclick = () => this.showScreen('start');
        this.dom.startGameBtn.onclick = () => this.startGame();
        
        // Game
        this.dom.giveUpBtn.onclick = () => this.giveUp();
        this.dom.solveBtn.onclick = () => this.openSolveModal();
        
        // Quit
        document.getElementById('quitBtn').onclick = () => this.dom.quitModal.classList.add('active');
        document.getElementById('cancelQuitBtn').onclick = () => this.dom.quitModal.classList.remove('active');
        document.getElementById('confirmQuitBtn').onclick = () => this.confirmQuit();
        
        // Solve modal
        document.getElementById('cancelSolveBtn').onclick = () => this.closeSolveModal();
        document.getElementById('submitSolveBtn').onclick = () => this.submitSolve();
        this.dom.solveInput?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.submitSolve();
            }
        });
        
        // Game over
        document.getElementById('playAgainBtn').onclick = () => this.playAgain();
        document.getElementById('shareBtn').onclick = () => this.shareScore();
        document.getElementById('menuBtn').onclick = () => this.showScreen('start');
        
        // Daily
        this.dom.dailySubmitBtn.onclick = () => this.submitDailyGuess();
        this.dom.dailySkipBtn.onclick = () => this.skipDailyQuestion();
        this.dom.dailyInput?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.submitDailyGuess();
            }
        });
        document.getElementById('dailyShareBtn').onclick = () => this.shareDailyScore();
        document.getElementById('dailyMenuBtn').onclick = () => this.showScreen('start');
    }

    // ============================================
    // SETTINGS
    // ============================================
    
    loadSettings() {
        const saved = localStorage.getItem('plotTwistedSettings');
        this.settings = saved ? JSON.parse(saved) : { sound: false, roastMode: 'clean' };
        this.dom.soundToggle?.classList.toggle('active', this.settings.sound);
        if (this.dom.roastModeSelect) this.dom.roastModeSelect.value = this.settings.roastMode;
    }

    saveSettings() {
        localStorage.setItem('plotTwistedSettings', JSON.stringify(this.settings));
    }

    toggleSound() {
        this.settings.sound = !this.settings.sound;
        this.dom.soundToggle?.classList.toggle('active', this.settings.sound);
        this.saveSettings();
    }

    handleRoastModeChange(mode) {
        if (mode === 'nsfw') {
            if (!confirm('NSFW mode includes explicit language. Continue?')) {
                this.dom.roastModeSelect.value = this.settings.roastMode;
                return;
            }
        }
        this.settings.roastMode = mode;
        this.saveSettings();
    }
    
    resetProgress() {
        if (confirm('Clear all stats and seen clues?')) {
            localStorage.removeItem('plotTwistedSeen');
            this.state.seenClues = {};
            this.showScreen('start');
        }
    }

    // ============================================
    // SCREENS
    // ============================================

    showScreen(name) {
        Object.values(this.screens).forEach(s => s.classList.remove('active'));
        this.screens[name]?.classList.add('active');
        this.state.currentScreen = name;
    }

    confirmQuit() {
        this.dom.quitModal.classList.remove('active');
        this.showScreen('start');
    }

    // ============================================
    // DAILY QUOTE
    // ============================================

    loadDailyQuote() {
        const today = new Date().toDateString();
        const stored = localStorage.getItem('ptQuoteDate');
        let index = parseInt(localStorage.getItem('ptQuoteIndex'), 10);
        
        if (stored !== today || isNaN(index)) {
            index = Math.floor(Math.random() * DAILY_QUOTES.length);
            localStorage.setItem('ptQuoteDate', today);
            localStorage.setItem('ptQuoteIndex', String(index));
        }
        
        const quote = DAILY_QUOTES[index] || DAILY_QUOTES[0];
        this.dom.dailyQuote.textContent = `"${quote.quote}"`;
        this.dom.dailyQuoteSource.textContent = `‚Äî ${quote.source}`;
    }

    // ============================================
    // CATEGORY SCREEN
    // ============================================

    showCategoryScreen() {
        this.renderCategories();
        this.state.selectedCategory = null;
        this.dom.startGameBtn.disabled = true;
        this.showScreen('category');
    }

    renderCategories() {
        if (!this.clueBank) return;
        
        this.dom.categoryGrid.innerHTML = '';
        
        Object.keys(this.clueBank).forEach(name => {
            const card = document.createElement('div');
            card.className = 'category-card';
            card.dataset.category = name;
            
            const icon = CATEGORY_ICONS[name] || CATEGORY_ICONS["Family"];
            
            card.innerHTML = `
                <div class="category-icon">${icon}</div>
                <div class="category-name">${name}</div>
            `;
            
            card.onclick = () => this.selectCategory(name);
            this.dom.categoryGrid.appendChild(card);
        });
    }

    selectCategory(name) {
        document.querySelectorAll('.category-card').forEach(c => c.classList.remove('selected'));
        document.querySelector(`.category-card[data-category="${name}"]`)?.classList.add('selected');
        this.state.selectedCategory = name;
        this.dom.startGameBtn.disabled = false;
    }

    // ============================================
    // QUICK PLAY GAME
    // ============================================

    startGame() {
        const category = this.state.selectedCategory;
        const allClues = this.clueBank[category];
        
        const seenTitles = this.state.seenClues[category] || [];
        const unseenClues = allClues.filter(c => !seenTitles.includes(c.title));
        const seenClues = allClues.filter(c => seenTitles.includes(c.title));
        
        let pool = this.shuffle(unseenClues);
        if (pool.length < this.config.questionsPerRound) {
            pool = [...pool, ...this.shuffle(seenClues)];
        }
        
        this.state.questions = pool.slice(0, this.config.questionsPerRound);
        
        if (!this.state.seenClues[category]) this.state.seenClues[category] = [];
        this.state.questions.forEach(q => {
            if (!this.state.seenClues[category].includes(q.title)) {
                this.state.seenClues[category].push(q.title);
            }
        });
        this.saveSeenClues();
        
        this.state.currentIndex = 0;
        this.state.totalScore = 0;
        this.state.strikes = 3;
        this.state.results = [];
        
        this.renderProgress();
        this.updateTotalScore();
        this.updateStrikes();
        
        this.showScreen('game');
        this.loadQuestion();
    }

    loadQuestion() {
        const q = this.state.questions[this.state.currentIndex];
        
        this.state.currentPot = this.config.maxPot;
        this.state.revealedIndices = [];
        this.state.guessedLetters = [];
        
        // Auto-reveal numbers since keyboard has no number keys
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        displayTitle.split('').forEach((char, i) => {
            if (/[0-9]/.test(char)) {
                this.state.revealedIndices.push(i);
            }
        });
        
        this.dom.clueText.textContent = q.clue;
        this.dom.clueCategory.textContent = this.state.selectedCategory;
        this.updatePot();
        this.updateProgress();
        this.renderTitle();
        this.renderKeyboard();
    }

    renderTitle() {
        const q = this.state.questions[this.state.currentIndex];
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        
        this.dom.titleLetters.innerHTML = '';
        
        displayTitle.split('').forEach((char, i) => {
            const slot = document.createElement('span');
            slot.className = 'letter-slot';
            
            if (char === ' ') {
                slot.classList.add('space');
            } else if (/[A-Z0-9]/.test(char)) {
                if (this.state.revealedIndices.includes(i)) {
                    slot.textContent = char;
                    slot.classList.add('revealed');
                } else {
                    slot.textContent = '_';
                    slot.classList.add('hidden');
                }
            } else {
                slot.textContent = char;
            }
            
            this.dom.titleLetters.appendChild(slot);
        });
    }

    renderKeyboard() {
        const rows = ['QWERTYUIOP', 'ASDFGHJKL', 'ZXCVBNM'];
        
        this.dom.keyboard.innerHTML = '';
        
        rows.forEach(row => {
            const rowEl = document.createElement('div');
            rowEl.className = 'keyboard-row';
            
            row.split('').forEach(letter => {
                const key = document.createElement('button');
                key.className = 'key';
                key.textContent = letter;
                key.dataset.letter = letter;
                
                if (this.state.guessedLetters.includes(letter)) {
                    key.disabled = true;
                    key.classList.add(this.isLetterInTitle(letter) ? 'correct' : 'incorrect');
                }
                
                key.onclick = () => this.guessLetter(letter);
                rowEl.appendChild(key);
            });
            
            this.dom.keyboard.appendChild(rowEl);
        });
    }

    isLetterInTitle(letter) {
        const q = this.state.questions[this.state.currentIndex];
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        return displayTitle.includes(letter);
    }

    guessLetter(letter) {
        if (this.state.guessedLetters.includes(letter)) return;
        
        this.state.guessedLetters.push(letter);
        
        const q = this.state.questions[this.state.currentIndex];
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        
        let found = false;
        displayTitle.split('').forEach((char, i) => {
            if (char === letter) {
                this.state.revealedIndices.push(i);
                found = true;
            }
        });
        
        // Vowels are free - no penalty for wrong vowel guesses
        const vowels = ['A', 'E', 'I', 'O', 'U'];
        const isVowel = vowels.includes(letter);
        
        if (!found && !isVowel) {
            this.state.currentPot = Math.max(this.config.minPot, this.state.currentPot - this.config.wrongLetterCost);
            this.updatePot(true);
        }
        
        this.renderTitle();
        this.renderKeyboard();
        this.updateMultiplier();
        
        // Check if all letters revealed
        const allLetterIndices = [];
        displayTitle.split('').forEach((char, i) => {
            if (/[A-Z0-9]/.test(char)) allLetterIndices.push(i);
        });
        
        if (allLetterIndices.every(i => this.state.revealedIndices.includes(i))) {
            this.autoSolve();
        }
    }

    updateMultiplier() {
        const q = this.state.questions[this.state.currentIndex];
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        
        let totalLetters = 0;
        displayTitle.split('').forEach(char => {
            if (/[A-Z0-9]/.test(char)) totalLetters++;
        });
        
        const hiddenCount = totalLetters - this.state.revealedIndices.length;
        const hiddenPercent = hiddenCount / totalLetters;
        
        let multiplier = '';
        if (hiddenPercent >= 0.8) multiplier = '1.5√ó';
        else if (hiddenPercent >= 0.5) multiplier = '1.25√ó';
        
        this.dom.potMultiplier.textContent = multiplier;
    }

    getMultiplier() {
        const q = this.state.questions[this.state.currentIndex];
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        
        let totalLetters = 0;
        displayTitle.split('').forEach(char => {
            if (/[A-Z0-9]/.test(char)) totalLetters++;
        });
        
        const hiddenCount = totalLetters - this.state.revealedIndices.length;
        const hiddenPercent = hiddenCount / totalLetters;
        
        if (hiddenPercent >= 0.8) return 1.5;
        if (hiddenPercent >= 0.5) return 1.25;
        return 1;
    }

    autoSolve() {
        const q = this.state.questions[this.state.currentIndex];
        const multiplier = this.getMultiplier();
        const points = Math.round(this.state.currentPot * multiplier);
        
        this.state.results.push({ title: q.title, points, correct: true });
        this.state.totalScore += points;
        this.updateTotalScore();
        this.showResult(true, q.title, points);
    }

    giveUp() {
        const q = this.state.questions[this.state.currentIndex];
        
        this.state.results.push({ title: q.title, points: 0, correct: false, gaveUp: true });
        
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        displayTitle.split('').forEach((char, i) => {
            if (/[A-Z0-9]/.test(char)) this.state.revealedIndices.push(i);
        });
        this.renderTitle();
        
        this.showResult(false, q.title, 0, false, true);
    }

    openSolveModal() {
        this.dom.solveModal.classList.add('active');
        this.dom.solveInput.value = '';
        setTimeout(() => this.dom.solveInput.focus(), 100);
    }

    closeSolveModal() {
        this.dom.solveModal.classList.remove('active');
    }

    submitSolve() {
        const guess = this.dom.solveInput.value.trim();
        if (!guess) return;

        const q = this.state.questions[this.state.currentIndex];
        this.closeSolveModal();
        
        if (this.isFuzzyMatch(guess, q.title)) {
            this.handleCorrect();
        } else {
            this.handleIncorrect();
        }
    }

    handleCorrect() {
        const q = this.state.questions[this.state.currentIndex];
        const multiplier = this.getMultiplier();
        const points = Math.round(this.state.currentPot * multiplier);
        
        this.state.results.push({ title: q.title, points, correct: true });
        this.state.totalScore += points;
        this.updateTotalScore();
        
        const displayTitle = this.getDisplayTitle(q.title).toUpperCase();
        displayTitle.split('').forEach((char, i) => {
            if (/[A-Z0-9]/.test(char)) this.state.revealedIndices.push(i);
        });
        this.renderTitle();
        
        this.showResult(true, q.title, points);
        
        try {
            if (typeof confetti === 'function') {
                confetti({
                    particleCount: 80,
                    spread: 60,
                    origin: { y: 0.6 },
                    colors: ['#d4a853', '#f0d078', '#ffffff'],
                    disableForReducedMotion: true
                });
            }
        } catch (e) {}
    }

    handleIncorrect() {
        const q = this.state.questions[this.state.currentIndex];
        
        this.state.strikes--;
        this.updateStrikes();
        
        this.dom.clueCard.classList.add('shake');
        setTimeout(() => this.dom.clueCard.classList.remove('shake'), 400);
        
        if (this.state.strikes <= 0) {
            this.state.results.push({ title: q.title, points: 0, correct: false });
            this.showResult(false, q.title, 0, true);
        } else {
            this.showResult(false, q.title, 0, false);
        }
    }

    showResult(isCorrect, title, points, isGameOver = false, gaveUp = false) {
        const resultCard = document.querySelector('.result-card');
        resultCard.classList.remove('celebrate');

        const commentary = this.getRoastMessage(isCorrect);

        this.dom.resultIcon.textContent = isCorrect ? 'üé¨' : (gaveUp ? 'üè≥Ô∏è' : '‚ùå');
        this.dom.resultTitle.textContent = commentary;
        this.dom.resultTitle.className = `result-title ${isCorrect ? 'correct' : 'incorrect'}`;
        
        if (isCorrect || gaveUp || isGameOver) {
            this.dom.resultMovie.textContent = title.toUpperCase();
            this.dom.resultMovie.style.display = 'block';
        } else {
            this.dom.resultMovie.style.display = 'none';
        }
        
        if (isCorrect) {
            resultCard.classList.add('celebrate');
            this.dom.resultPoints.textContent = `+${points} points`;
            this.dom.resultPoints.className = 'result-points';
        } else if (isGameOver) {
            this.dom.resultPoints.textContent = 'Out of strikes!';
            this.dom.resultPoints.className = 'result-points zero';
        } else if (gaveUp) {
            this.dom.resultPoints.textContent = '0 points';
            this.dom.resultPoints.className = 'result-points zero';
        } else {
            this.dom.resultPoints.textContent = `${this.state.strikes} strike${this.state.strikes !== 1 ? 's' : ''} remaining`;
            this.dom.resultPoints.className = 'result-points zero';
        }
        
        if (!isCorrect && !isGameOver && !gaveUp) {
            this.dom.continueBtn.textContent = 'Try Again';
            this.dom.continueBtn.onclick = () => {
                this.dom.resultOverlay.classList.remove('active');
            };
        } else {
            this.dom.continueBtn.textContent = 'Continue';
            this.dom.continueBtn.onclick = () => {
                this.dom.resultOverlay.classList.remove('active');
                if (isGameOver) {
                    this.endGame();
                } else {
                    this.nextQuestion();
                }
            };
        }
        
        this.dom.resultOverlay.classList.add('active');
    }

    getRoastMessage(isCorrect) {
        const mode = this.settings?.roastMode || 'clean';
        const list = isCorrect ? (PRAISE_MESSAGES[mode] || PRAISE_MESSAGES.clean) : (INSULT_MESSAGES[mode] || INSULT_MESSAGES.clean);
        return list[Math.floor(Math.random() * list.length)] || (isCorrect ? 'Nice!' : 'Nope!');
    }

    nextQuestion() {
        this.state.currentIndex++;
        
        if (this.state.currentIndex >= this.state.questions.length) {
            this.endGame();
        } else {
            this.loadQuestion();
        }
    }

    endGame() {
        const solved = this.state.results.filter(r => r.correct).length;
        const total = this.state.results.length;
        
        this.dom.finalScore.textContent = this.state.totalScore;
        this.dom.finalSubtitle.textContent = `${solved} of ${total} movies solved`;
        
        this.dom.finalBreakdown.innerHTML = '';
        this.state.results.forEach(r => {
            const row = document.createElement('div');
            row.className = 'breakdown-row';
            row.innerHTML = `
                <span class="breakdown-title">${r.title}</span>
                <span class="breakdown-points ${r.correct ? 'earned' : 'missed'}">
                    ${r.correct ? '+' + r.points : '‚Äî'}
                </span>
            `;
            this.dom.finalBreakdown.appendChild(row);
        });
        
        this.showScreen('gameOver');
    }
    
    shareScore() {
        const solved = this.state.results.filter(r => r.correct).length;
        const total = this.state.results.length;
        const category = this.state.selectedCategory;
        
        const emoji = this.state.results.map(r => r.correct ? 'üü©' : (r.gaveUp ? 'üü®' : 'üü•')).join('');
        
        const text = `üé¨ Plot Twisted - ${category}
üèÜ Score: ${this.state.totalScore}
${emoji}
${solved}/${total} correct

Can you beat me?`;
        
        if (navigator.share) {
            navigator.share({ text }).catch(() => this.copyToClipboard(text));
        } else {
            this.copyToClipboard(text);
        }
    }
    
    copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('Score copied to clipboard!');
        }).catch(() => {});
    }

    playAgain() {
        if (this.state.selectedCategory) {
            this.startGame();
        } else {
            this.showCategoryScreen();
        }
    }

    // ============================================
    // DAILY CHALLENGE
    // ============================================

    getTodayKey() {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    }

    checkDailyStatus() {
        const key = `plotTwistedDaily_${this.getTodayKey()}`;
        const saved = localStorage.getItem(key);
        
        if (saved) {
            this.state.dailyCompleted = true;
            this.state.dailyResults = JSON.parse(saved);
        } else {
            this.state.dailyCompleted = false;
            this.state.dailyResults = [];
        }
    }

    startDaily() {
        this.checkDailyStatus();
        
        if (this.state.dailyCompleted) {
            this.showDailyResults();
            return;
        }
        
        // Seed random with today's date
        const seed = this.getTodayKey().replace(/-/g, '');
        const rng = this.seededRandom(parseInt(seed, 10));
        
        // Pick one from each category
        const categories = Object.keys(this.clueBank);
        const shuffledCats = this.shuffleWithRng(categories, rng);
        
        this.state.dailyQuestions = [];
        for (let i = 0; i < 5; i++) {
            const cat = shuffledCats[i % shuffledCats.length];
            const clues = this.clueBank[cat];
            const clueIndex = Math.floor(rng() * clues.length);
            this.state.dailyQuestions.push({ ...clues[clueIndex], category: cat });
        }
        
        this.state.dailyIndex = 0;
        this.state.dailyResults = [];
        
        const today = new Date();
        this.dom.dailyDateDisplay.textContent = today.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        
        this.renderDailyProgress();
        this.loadDailyQuestion();
        this.showScreen('daily');
    }

    seededRandom(seed) {
        return function() {
            seed = (seed * 9301 + 49297) % 233280;
            return seed / 233280;
        };
    }

    shuffleWithRng(arr, rng) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(rng() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    renderDailyProgress() {
        this.dom.dailyProgressTrack.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const pip = document.createElement('div');
            pip.className = 'progress-pip';
            if (i < this.state.dailyIndex) pip.classList.add('complete');
            if (i === this.state.dailyIndex) pip.classList.add('current');
            this.dom.dailyProgressTrack.appendChild(pip);
        }
    }

    loadDailyQuestion() {
        const q = this.state.dailyQuestions[this.state.dailyIndex];
        this.dom.dailyClueCard.dataset.question = `MOVIE ${this.state.dailyIndex + 1} OF 5`;
        this.dom.dailyClueText.textContent = q.clue;
        this.dom.dailyInput.value = '';
        this.dom.dailyInput.disabled = false;
        this.dom.dailyInput.focus();
    }

    submitDailyGuess() {
        const guess = this.dom.dailyInput.value.trim();
        if (!guess) return;
        
        const q = this.state.dailyQuestions[this.state.dailyIndex];
        const correct = this.isFuzzyMatch(guess, q.title);
        
        this.state.dailyResults.push({
            title: q.title,
            guess: guess,
            correct: correct,
            points: correct ? 100 : 0
        });
        
        this.dom.dailyInput.disabled = true;
        this.nextDailyQuestion();
    }

    skipDailyQuestion() {
        const q = this.state.dailyQuestions[this.state.dailyIndex];
        
        this.state.dailyResults.push({
            title: q.title,
            guess: '',
            correct: false,
            skipped: true,
            points: 0
        });
        
        this.nextDailyQuestion();
    }

    nextDailyQuestion() {
        this.state.dailyIndex++;
        this.renderDailyProgress();
        
        if (this.state.dailyIndex >= 5) {
            this.finishDaily();
        } else {
            this.loadDailyQuestion();
        }
    }

    finishDaily() {
        const key = `plotTwistedDaily_${this.getTodayKey()}`;
        localStorage.setItem(key, JSON.stringify(this.state.dailyResults));
        this.state.dailyCompleted = true;
        this.showDailyResults();
    }

    showDailyResults() {
        const results = this.state.dailyResults;
        const correct = results.filter(r => r.correct).length;
        const total = results.reduce((sum, r) => sum + r.points, 0);
        
        const today = new Date();
        this.dom.dailyResultsDate.textContent = today.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        
        // Stars
        this.dom.dailyScoreDisplay.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const star = document.createElement('span');
            star.className = `daily-star ${i < correct ? 'earned' : 'empty'}`;
            star.textContent = '‚òÖ';
            this.dom.dailyScoreDisplay.appendChild(star);
        }
        
        this.dom.dailyScoreText.textContent = `${correct}/5 Correct ‚Ä¢ ${total} pts`;
        
        // Breakdown
        this.dom.dailyBreakdown.innerHTML = '';
        results.forEach(r => {
            const row = document.createElement('div');
            row.className = 'daily-breakdown-row';
            row.innerHTML = `
                <span>${r.title}</span>
                <span class="daily-breakdown-result">${r.correct ? '‚úÖ' : (r.skipped ? '‚è≠Ô∏è' : '‚ùå')}</span>
            `;
            this.dom.dailyBreakdown.appendChild(row);
        });
        
        // Countdown
        this.updateDailyCountdown();
        
        this.showScreen('dailyResults');
    }

    updateDailyCountdown() {
        const now = new Date();
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        
        const diff = tomorrow - now;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        this.dom.dailyNextPuzzle.textContent = `Next puzzle in ${hours}h ${minutes}m`;
    }

    shareDailyScore() {
        const results = this.state.dailyResults;
        const correct = results.filter(r => r.correct).length;
        const total = results.reduce((sum, r) => sum + r.points, 0);
        
        const emoji = results.map(r => r.correct ? '‚≠ê' : '‚òÜ').join('');
        const today = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        
        const text = `üé¨ Plot Twisted Daily - ${today}
${emoji} ${correct}/5
Score: ${total}

Can you beat me?`;
        
        if (navigator.share) {
            navigator.share({ text }).catch(() => this.copyToClipboard(text));
        } else {
            this.copyToClipboard(text);
        }
    }

    // ============================================
    // UTILITIES
    // ============================================

    updatePot(animate = false) {
        if (animate) {
            this.dom.potValue.classList.add('dropping');
            setTimeout(() => this.dom.potValue.classList.remove('dropping'), 300);
        }
        this.dom.potValue.textContent = this.state.currentPot;
        this.updateMultiplier();
    }

    updateTotalScore() {
        this.dom.totalScore.textContent = this.state.totalScore;
    }

    updateStrikes() {
        const pips = this.dom.strikesDisplay.querySelectorAll('.strike-pip');
        pips.forEach((pip, i) => {
            pip.classList.toggle('used', i >= this.state.strikes);
        });
    }

    renderProgress() {
        this.dom.progressTrack.innerHTML = '';
        for (let i = 0; i < this.config.questionsPerRound; i++) {
            const pip = document.createElement('div');
            pip.className = 'progress-pip';
            this.dom.progressTrack.appendChild(pip);
        }
    }

    updateProgress() {
        const pips = this.dom.progressTrack.querySelectorAll('.progress-pip');
        pips.forEach((pip, i) => {
            pip.classList.remove('current', 'complete');
            if (i < this.state.currentIndex) pip.classList.add('complete');
            else if (i === this.state.currentIndex) pip.classList.add('current');
        });
    }

    levenshtein(a, b) {
        const matrix = [];
        for (let i = 0; i <= b.length; i++) matrix[i] = [i];
        for (let j = 0; j <= a.length; j++) matrix[0][j] = j;

        for (let i = 1; i <= b.length; i++) {
            for (let j = 1; j <= a.length; j++) {
                if (b.charAt(i - 1) === a.charAt(j - 1)) {
                    matrix[i][j] = matrix[i - 1][j - 1];
                } else {
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j - 1] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j] + 1
                    );
                }
            }
        }
        return matrix[b.length][a.length];
    }

    normalizeTitle(str) {
        return str
            .toLowerCase()
            .replace(/\([^)]*\)/g, '')
            .replace(/^the\s+/g, '')
            .replace(/[^a-z0-9]/g, ' ')
            .replace(/\s+/g, ' ')
            .trim();
    }
    
    // Strip numbers for more lenient matching
    stripNumbers(str) {
        return str.replace(/[0-9]/g, '').replace(/\s+/g, ' ').trim();
    }

    getDisplayTitle(title) {
        return title.replace(/\([^)]*\)/g, '').trim();
    }

    isFuzzyMatch(guess, actual) {
        const g = this.normalizeTitle(guess);
        const a = this.normalizeTitle(actual);

        if (!g) return false;
        if (g === a) return true;

        // Check with numbers
        const distance = this.levenshtein(g, a);
        const maxErrors = Math.floor(a.length * this.config.fuzzyThreshold);
        if (distance <= Math.max(1, maxErrors)) return true;
        
        // Also check without numbers (forgive "Inside Out" for "Inside Out 2")
        const gNoNum = this.stripNumbers(g);
        const aNoNum = this.stripNumbers(a);
        
        if (gNoNum === aNoNum) return true;
        
        const distanceNoNum = this.levenshtein(gNoNum, aNoNum);
        const maxErrorsNoNum = Math.floor(aNoNum.length * this.config.fuzzyThreshold);
        
        return distanceNoNum <= Math.max(1, maxErrorsNoNum);
    }

    loadSeenClues() {
        const saved = localStorage.getItem('plotTwistedSeen');
        this.state.seenClues = saved ? JSON.parse(saved) : {};
    }

    saveSeenClues() {
        localStorage.setItem('plotTwistedSeen', JSON.stringify(this.state.seenClues));
    }

    shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    const game = new PlotTwisted();
    game.init();
});
</script>
</body>
</html>
